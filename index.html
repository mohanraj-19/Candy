<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Candy Crush Clone</title>
<style>
    :root{
        --size:60px;               /* one tile size */
        --gap:2px;                 /* grid gap      */
        --grid:8;                  /* width/height  */
        --colors:red,orange,yellow,green,blue,purple;
    }
    *{box-sizing:border-box;margin:0}
    body{
        display:flex;flex-direction:column;align-items:center;
        font-family:system-ui,Arial,sans-serif;background:#222;color:#fff;height:100vh;
        justify-content:center;gap:20px;overflow:hidden
    }
    h1{letter-spacing:2px;font-size:2rem}
    #score{font-weight:bold}
    .grid{
        display:grid;
        grid-template-columns:repeat(var(--grid),var(--size));
        grid-template-rows:repeat(var(--grid),var(--size));
        gap:var(--gap);
        background:#444;padding:var(--gap);border-radius:12px;
        touch-action:none;          /* smoother mobile drags */
    }
    .square{
        width:var(--size);height:var(--size);border-radius:12px;
        cursor:grab;user-select:none;
        transition:transform .15s
    }
    .square:active{cursor:grabbing;transform:scale(.9)}
    button{
        padding:.6em 1.4em;border:none;border-radius:8px;
        background:#ff6b6b;color:#fff;font-weight:600;font-size:1rem;cursor:pointer
    }
    button:hover{background:#ff8787}
</style>
</head>
<body>
<h1>üç¨ Candy Crush Clone</h1>
<div>Score: <span id="score">0</span></div>
<div class="grid" id="grid"></div>
<button id="restart">New Game</button>

<script>
(function(){
    /* ----- CONFIG ----- */
    const width   = 8;                         // grid is 8√ó8
    const colors  = ['red','orange','yellow','green','blue','purple'];
    const squares = [];                        // will hold divs
    const grid    = document.getElementById('grid');
    const scoreEl = document.getElementById('score');
    let score     = 0;
    let dragStart, dragEnd;

    /* ----- INIT GRID ----- */
    function createBoard(){
        grid.innerHTML=''; squares.length=0; score=0; updateScore(0);
        for(let i=0;i<width*width;i++){
            const square=document.createElement('div');
            square.setAttribute('draggable',true);
            square.setAttribute('id',i);
            const color=randomColor();
            square.style.background=color;
            square.classList.add('square');
            grid.appendChild(square);
            squares.push(square);
        }
    }

    /* ----- HELPERS ----- */
    const randomColor=()=>colors[Math.floor(Math.random()*colors.length)];
    const updateScore=inc=>{score+=inc;scoreEl.textContent=score};

    /* ----- DRAG EVENTS ----- */
    squaresEvents();
    function squaresEvents(){
        grid.addEventListener('dragstart',e=>{
            if(!e.target.classList.contains('square'))return;
            dragStart=e.target;
            dragEnd=null;
        });
        grid.addEventListener('dragover',e=>e.preventDefault());
        grid.addEventListener('drop',e=>{
            if(!e.target.classList.contains('square'))return;
            dragEnd=e.target;
        });
        grid.addEventListener('dragend',()=>{
            if(!dragEnd)return;
            const startId=parseInt(dragStart.id);
            const endId  =parseInt(dragEnd.id);
            const validMoves=[startId-1,startId+1,startId-width,startId+width];
            if(validMoves.includes(endId)){
                swapColors(dragStart,dragEnd);
                const matchFound=checkMatches();
                if(!matchFound)swapColors(dragStart,dragEnd); // revert
            }
            dragStart=dragEnd=null;
        });
    }

    function swapColors(el1,el2){
        const temp=el1.style.background;
        el1.style.background=el2.style.background;
        el2.style.background=temp;
    }

    /* ----- MATCH CHECKERS ----- */
    function checkMatches(){
        let matched=false;
        // check rows of 4
        for(let i=0;i<64;i++){
            const rowEnd=[5,6,7,13,14,15,21,22,23,29,30,31,37,38,39,45,46,47,53,54,55];
            if(rowEnd.includes(i))continue;
            const row=[i,i+1,i+2,i+3];
            matched|=colorMatch(row,4);
        }
        // check columns of 4
        for(let i=0;i<32;i++){
            const col=[i,i+width,i+width*2,i+width*3];
            matched|=colorMatch(col,4);
        }
        // rows of 3
        for(let i=0;i<64;i++){
            const rowEnd=[6,7,14,15,22,23,30,31,38,39,46,47,54,55];
            if(rowEnd.includes(i))continue;
            const row=[i,i+1,i+2];
            matched|=colorMatch(row,3);
        }
        // columns of 3
        for(let i=0;i<40;i++){
            const col=[i,i+width,i+width*2];
            matched|=colorMatch(col,3);
        }
        if(matched)setTimeout(dropCandies,200);
        return matched;
    }

    function colorMatch(indices,len){
        const firstColor=squares[indices[0]].style.background;
        if(firstColor==='')return false;
        if(indices.every(idx=>squares[idx].style.background===firstColor)){
            indices.forEach(idx=>squares[idx].style.background='');
            updateScore(len);
            return true;
        }
        return false;
    }

    /* ----- DROP & REPLACE ----- */
    function dropCandies(){
        for(let i=55;i>=0;i--){
            if(squares[i+width].style.background===''){
                squares[i+width].style.background=squares[i].style.background;
                squares[i].style.background='';
            }
        }
        // top row: generate new candies
        for(let i=0;i<width;i++){
            if(squares[i].style.background===''){
                squares[i].style.background=randomColor();
            }
        }
        // look for new matches
        setTimeout(checkMatches,100);
    }

    /* ----- GAME LOOP ----- */
    createBoard();
    setInterval(checkMatches,150);

    /* ----- RESTART ----- */
    document.getElementById('restart').onclick=createBoard;
})();
</script>
</body>
</html>
